/*
	canvas-to-bmp version 1.2.0 BETA
	By Epistemex (c) 2015-2016
	www.epistemex.com
	MIT License (this header required)
*/
var CanvasToBMP={_dly:9,toArrayBuffer:function(f,e,k){try{var q=this,G=f.width,n=f.height,H=G<<2,o=f.getContext("2d").getImageData(0,0,G,n),i=new Uint32Array(o.data.buffer),D=((32*G+31)/32)<<2,t=D*n,m=122+t,l=new ArrayBuffer(m),F=new DataView(l),d=1<<20,c=d,J=0,I,E,b,u=0,r,z=0;B(19778);C(m);A(4);C(122);C(108);C(G);C(-n>>>0);B(1);B(32);C(3);C(t);C(2835);C(2835);A(8);C(16711680);C(65280);C(255);C(4278190080);C(1466527264);(function g(){while(J<n&&c>0){r=122+J*D;I=0;while(I<H){c--;E=i[z++];b=E>>>24;F.setUint32(r+I,(E<<8)|b);I+=4}J++}if(z<i.length){c=d;setTimeout(g,q._dly)}else{e(l)}})()}catch(j){if(k){k(j.toString())}}function B(a){F.setUint16(u,a,!0);u+=2}function C(a){F.setUint32(u,a,!0);u+=4}function A(a){u+=a}},toBlob:function(b,a,c){this.toArrayBuffer(b,function(d){a(new Blob([d],{type:"image/bmp"}))},c||null)},toObjectURL:function(b,a,c){this.toBlob(b,function(d){var e=self.URL||self.webkitURL||self;a(e.createObjectURL(d))},c||null)},toDataURL:function(b,a,c){var d=this;this.toArrayBuffer(b,function(k){var j=new Uint8Array(k),g=1<<20,f=g,h="",e="",m=0,n=j.length;(function o(){while(m<n&&f-->0){h+=String.fromCharCode(j[m++])}if(m<n){f=g;setTimeout(o,d._dly)}else{m=0;n=h.length;f=180000;(function i(){e+=btoa(h.substr(m,f));m+=f;(m<n)?setTimeout(i,d._dly):a("data:image/bmp;base64,"+e)})()}})()},c||null)}};